---
title: redis-limit
date: 2020-04-03 21:38:41
tags:
    - 软件
    - redis
    - 秒杀
    - 限流
categories:
    - soft
---

### 借助Redis做秒杀和限流的思考

>Redis单线程模型
``` 
var count = rds.inc(key);

if(count > 1000)｛

    rds.dec(key);

    throw "超出限额！"

｝
```


当然，对于很大量的秒杀，这个模型也不一定合理，比如要枪10万部手机，然后来了300万用户，瞬间挤上来。

这里有个变通方法可以试一下，那就是准备10个Redis实例，每个放1万。用户请求过来的时候，可以随机数或者散列取模，找对应实例来进行抢购。

随机和散列就具有一定统计学意义

#### Redis怎么做到220万ops

1，Redis是单线程模型，因此32核心服务器安装32个实例

2，数据分片，key散列后均分到几十个实例上

3，关闭持久化，运维和Linux保证可靠性

4，控制好数据包大小，高性能网络通信最忌收发大量小包，控制在1400字节附近最佳，最差也要pipeline

5，其它在网上能轻易找到的细小技巧